import{importShared as e}from"./__federation_fn_import-B6DyUTOO.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{toDisplayString:a,createTextVNode:l,resolveComponent:s,withCtx:r,createVNode:n,openBlock:c,createBlock:i,createCommentVNode:o,createElementBlock:d,normalizeClass:u,createElementVNode:p}=await e("vue"),f={class:"dashboard-widget"},v={key:0,class:"text-center py-2"},m={key:1,class:"text-error text-caption d-flex align-center"},g={key:2},_={key:3,class:"text-caption text-disabled text-center py-2"},x={class:"text-caption text-disabled"},{ref:y,reactive:h,onMounted:b,onUnmounted:k,computed:w}=await e("vue"),S=t({__name:"Dashboard",props:{api:{type:[Object,Function],required:!0},config:{type:Object,default:()=>({attrs:{}})},allowRefresh:{type:Boolean,default:!1},refreshInterval:{type:Number,default:0}},setup(e){const t=e,S=y(!1),z=y(null),I=y(!1),C=y(null),N=h({enabled:!1,has_client:!1,running:!1});let j=null;async function B(){S.value=!0,z.value=null;try{const e="P115StrmHelper",a=await t.api.get(`plugin/${e}/get_status`);if(!a||0!==a.code||!a.data)throw new Error(a?.msg||"获取状态失败");N.enabled=a.data.enabled,N.has_client=a.data.has_client,N.running=a.data.running,I.value=!0,C.value=Date.now()}catch(e){console.error("获取仪表盘数据失败:",e),z.value=e.message||"获取数据失败"}finally{S.value=!1}}const D=w(()=>{if(!C.value)return"";const e=new Date(C.value);return`更新于: ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`});return b(()=>{B(),t.refreshInterval>0&&(j=setInterval(B,1e3*t.refreshInterval))}),k(()=>{j&&(clearInterval(j),j=null)}),(e,y)=>{const h=s("v-card-title"),b=s("v-card-subtitle"),k=s("v-card-item"),w=s("v-progress-circular"),C=s("v-icon"),j=s("v-list-item-title"),R=s("v-list-item"),V=s("v-list"),$=s("v-card-text"),E=s("v-divider"),M=s("v-spacer"),H=s("v-btn"),O=s("v-card-actions"),T=s("v-card");return c(),d("div",f,[n(T,{flat:!t.config?.attrs?.border,loading:S.value,class:"fill-height d-flex flex-column"},{default:r(()=>[t.config?.attrs?.title||t.config?.attrs?.subtitle?(c(),i(k,{key:0},{default:r(()=>[n(h,null,{default:r(()=>[l(a(t.config?.attrs?.title||"115网盘STRM助手"),1)]),_:1}),t.config?.attrs?.subtitle?(c(),i(b,{key:0},{default:r(()=>[l(a(t.config.attrs.subtitle),1)]),_:1})):o("",!0)]),_:1})):o("",!0),n($,{class:"flex-grow-1 pa-3"},{default:r(()=>[S.value&&!I.value?(c(),d("div",v,[n(w,{indeterminate:"",color:"primary",size:"small"})])):z.value?(c(),d("div",m,[n(C,{size:"small",color:"error",class:"mr-1"},{default:r(()=>y[0]||(y[0]=[l("mdi-alert-circle-outline")])),_:1}),l(" "+a(z.value||"数据加载失败"),1)])):I.value?(c(),d("div",g,[n(V,{density:"compact",class:"py-0"},{default:r(()=>[n(R,{class:"pa-0"},{prepend:r(()=>[n(C,{size:"small",color:N.enabled?"success":"grey",class:"mr-2"},{default:r(()=>[l(a(N.enabled?"mdi-check-circle":"mdi-close-circle"),1)]),_:1},8,["color"])]),default:r(()=>[n(j,{class:"text-caption"},{default:r(()=>[y[1]||(y[1]=l(" 插件状态: ")),p("span",{class:u(N.enabled?"text-success":"text-grey")},a(N.enabled?"已启用":"已禁用"),3)]),_:1})]),_:1}),n(R,{class:"pa-0"},{prepend:r(()=>[n(C,{size:"small",color:N.has_client?"success":"error",class:"mr-2"},{default:r(()=>[l(a(N.has_client?"mdi-account-check":"mdi-account-off"),1)]),_:1},8,["color"])]),default:r(()=>[n(j,{class:"text-caption"},{default:r(()=>[y[2]||(y[2]=l(" 115客户端: ")),p("span",{class:u(N.has_client?"text-success":"text-error")},a(N.has_client?"已连接":"未连接"),3)]),_:1})]),_:1}),n(R,{class:"pa-0"},{prepend:r(()=>[n(C,{size:"small",color:N.running?"success":"grey",class:"mr-2"},{default:r(()=>[l(a(N.running?"mdi-play-circle":"mdi-pause-circle"),1)]),_:1},8,["color"])]),default:r(()=>[n(j,{class:"text-caption"},{default:r(()=>[y[3]||(y[3]=l(" 任务状态: ")),p("span",{class:u(N.running?"text-success":"text-grey")},a(N.running?"运行中":"空闲"),3)]),_:1})]),_:1})]),_:1})])):(c(),d("div",_," 暂无数据 "))]),_:1}),t.allowRefresh?(c(),i(E,{key:1})):o("",!0),t.allowRefresh?(c(),i(O,{key:2,class:"px-3 py-1"},{default:r(()=>[p("span",x,a(D.value),1),n(M),n(H,{icon:"",variant:"text",size:"small",onClick:B,loading:S.value},{default:r(()=>[n(C,{size:"small"},{default:r(()=>y[4]||(y[4]=[l("mdi-refresh")])),_:1})]),_:1},8,["loading"])]),_:1})):o("",!0)]),_:1},8,["flat","loading"])])}}},[["__scopeId","data-v-3a59a36c"]]);export{S as default};
